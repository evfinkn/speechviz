<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Popup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Popup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import globals from "./globals";
import TreeItem from "./treeItem";
import { htmlToElement } from "./util";


const peaks = globals.peaks;

const Popup = class Popup {

    /**
     * 
     * @type {TreeItem}
     */
    treeItem;
    /**
     * 
     * @type {Element}
     */
    popup = htmlToElement("&lt;div class='popup'>&lt;div class='popup-content'>&lt;/div>&lt;/div>");
    /**
     * 
     * @type {Element}
     */
    popupContent = popup.firstElementChild;
    /**
     * 
     * @type {(Element|null)}
     */
    renameInput;
    /** */
    moveTo;
    /** */
    moveRadios;
    /** */
    copyTo;
    /** */
    copyRadios;

    constructor(treeItem) {
        this.treeItem = treeItem;

        const popupContent = this.popupContent;

        popupContent.appendChild(htmlToElement(`&lt;h2>${"Placeholder instructions"}&lt;/h2>`));
        const closeButton = htmlToElement("&lt;a class='close'>&amp;times&lt;/a>");
        popupContent.appendChild(closeButton);
        closeButton.addEventListener("click", () => this.hide());

        if (treeItem.renamable) {
            const renameInput = htmlToElement("&lt;input type='text' value='" + treeItem.span.innerHTML + "'>");
            this.renameInput = renameInput;
            popupContent.appendChild(renameInput);
            renameInput.addEventListener("keypress", function (event) {
                if (event.key === "Enter") { treeItem.rename(renameInput.value); }
            });
        }

        if (treeItem.moveTo) {
            this.moveTo = [];
            this.moveRadios = {};
            this.updateMoveTo();
        }

        if (treeItem.copyTo) {
            this.copyTo = [];
            this.copyRadios = {};
            this.updateCopyTo();
        }
    }

    show() {
        if (this.moveTo) { this.updateMoveTo(); }
        if (this.copyTo) { this.updateCopyTo(); }

        this.popup.style.display = "block";
    }

    hide() { this.popup.style.display = "none"; }

    updateMoveTo() {
        const moveTo = this.moveTo;
        const newMoveTo = this.treeItem.expandMoveTo();
        newMoveTo.filter(dest => !moveTo.includes(dest)).forEach(dest => this.addMoveRadio(dest));
        moveTo.filter(dest => !newMoveTo.includes(dest)).forEach(dest => this.removeMoveRadio(dest));
    }
    updateCopyTo() {
        const copyTo = this.copyTo;
        const newCopyTo = this.treeItem.expandCopyTo();
        newCopyTo.filter(dest => !copyTo.includes(dest)).forEach(dest => this.addCopyRadio(dest));
        copyTo.filter(dest => !newCopyTo.includes(dest)).forEach(dest => this.removeCopyRadio(dest));
    }

    addMoveRadio(id) {
        const moveRadios = this.moveRadios;
        const moveRadiosKeys = Object.keys(moveRadios);
        const popupContent = this.popupContent;
        const dest = TreeItem.byId[id];

        const radioDiv = htmlToElement(`&lt;div>&lt;input type="radio" name="${this.treeItem.id}-radios" id="${label}-radio" autocomplete="off">&lt;label for="${id}-radio">${label}&lt;/label>&lt;/div>&lt;br>`);

        if (moveRadiosKeys.length == 0) { popupContent.append(radioDiv); }
        else { moveRadios[moveRadiosKeys.at(-1)].after(radioDiv); }

        radioDiv.firstElementChild.addEventListener("change", () => {
            this.treeItem.parent = dest;
            this.hide();
        });

        this.moveTo.push(id);
        moveRadios[id] = radioDiv;
    }
    addCopyRadio(id) {
        const copyRadios = this.copyRadios;
        const copyRadiosKeys = Object.keys(copyRadios);
        const popupContent = this.popupContent;
        const dest = TreeItem.byId[id];

        const radioDiv = htmlToElement(`&lt;div>&lt;input type="radio" name="${this.treeItem.id}-radios" id="${label}-radio" autocomplete="off">&lt;label for="${id}-radio">${label}&lt;/label>&lt;/div>&lt;br>`);

        if (copyRadiosKeys.length == 0) { popupContent.append(radioDiv); }
        else { copyRadios[copyRadiosKeys.at(-1)].after(radioDiv); }

        radioDiv.firstElementChild.addEventListener("change", () => {
            this.treeItem.copy(dest);
            this.hide();
        });

        this.copyTo.push(id);
        copyRadios[id] = radioDiv;
    }
    removeMoveRadio(id) {
        this.moveRadios[id].remove();
        delete this.moveRadios[id];
        this.moveTo = this.moveTo.filter(dest => dest != id);
    }
    removeCopyRadio(id) {
        this.copyRadios[id].remove();
        delete this.copyRadios[id];
        this.copyTo = this.copyTo.filter(dest => dest != id);
    }
}

export default Popup;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CustomSegmentMarker.html">CustomSegmentMarker</a></li><li><a href="Group.html">Group</a></li><li><a href="Groups.html">Groups</a></li><li><a href="Segment.html">Segment</a></li><li><a href="TreeItem.html">TreeItem</a></li></ul><h3>Global</h3><ul><li><a href="global.html#arrayMean">arrayMean</a></li><li><a href="global.html#arraySum">arraySum</a></li><li><a href="global.html#compareProperty">compareProperty</a></li><li><a href="global.html#createSegmentMarker">createSegmentMarker</a></li><li><a href="global.html#getRandomColor">getRandomColor</a></li><li><a href="global.html#globals">globals</a></li><li><a href="global.html#htmlToElement">htmlToElement</a></li><li><a href="global.html#objectMap">objectMap</a></li><li><a href="global.html#propertiesEqual">propertiesEqual</a></li><li><a href="global.html#sortByProp">sortByProp</a></li><li><a href="global.html#toggleButton">toggleButton</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Sun Sep 18 2022 14:10:34 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
